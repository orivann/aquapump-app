global:
  env: stage
  imagePullSecrets:
    - name: ecr-creds

frontend:
  image:
    repository: 123456789012.dkr.ecr.eu-central-1.amazonaws.com/aquapump/frontend
    tag: stage
  service:
    port: 80
  existingSecret: aquapump-secrets

backend:
  image:
    repository: 123456789012.dkr.ecr.eu-central-1.amazonaws.com/aquapump/backend
    tag: stage
  service:
    port: 8000
  existingSecret: aquapump-secrets

externalSecret:
  enabled: true
  name: aquapump-secrets
  refreshInterval: 1h
  secretStoreRef:
    kind: ClusterSecretStore
    name: aws-secrets
  target:
    name: aquapump-secrets
    creationPolicy: Owner
  data:
    - secretKey: SUPABASE_URL
      remoteRef:
        key: stage/aquapump
        property: SUPABASE_URL
    - secretKey: SUPABASE_SERVICE_ROLE_KEY
      remoteRef:
        key: stage/aquapump
        property: SUPABASE_SERVICE_ROLE_KEY
    - secretKey: AI_API_KEY
      remoteRef:
        key: stage/aquapump
        property: AI_API_KEY
    - secretKey: VITE_REACT_APP_API_BASE
      remoteRef:
        key: stage/aquapump
        property: VITE_REACT_APP_API_BASE

ingress:
  enabled: true
  className: alb
  annotations:
    kubernetes.io/ingress.class: alb
    alb.ingress.kubernetes.io/scheme: internet-facing
    alb.ingress.kubernetes.io/target-type: ip
    alb.ingress.kubernetes.io/group.name: aquapump-stage
    external-dns.alpha.kubernetes.io/hostname: app.stage.aqua-pump.net
    cert-manager.io/cluster-issuer: letsencrypt-http01
  hosts:
    - host: app.stage.aqua-pump.net
      paths:
        - path: /
          pathType: Prefix
          service:
            name: aquapump-frontend
            port: 80
        - path: /api
          pathType: Prefix
          service:
            name: aquapump-backend
            port: 8000
  tls:
    - hosts:
        - app.stage.aqua-pump.net
      secretName: aquapump-stage-tls
